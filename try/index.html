<!DOCTYPE html>
<html>
  <head>
    <script language="javascript" src="rts.js"></script>
    <script language="javascript" src="lib.js"></script>
    <script language="javascript" src="out.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
  </body>
  <div id="actions">
      <button id="compile">Compile</button>
      <button id="run">Run</button>
  </div>
  <div id="errors">
  </div>
  <div id="source">
      <textarea id="crux_source">
data Node {}

type Document = {
    createTextNode : (String) -> Node,
    body : {
        insertBefore : (Node, Node) -> Node,
        firstChild : Node
    },
};

let document : Document = _unsafe_js("window.document");

fun main() {
    document.body.insertBefore(
        document.createTextNode("Hello!"),
        document.body.firstChild
    );
}

let _ = main();</textarea>
      <div id="js_source"></div>
  </div>
  <script src="runmain.js"></script>
  <script>
    function compileCrux(source) {
        var ret = {};
        window.hs_compileCrux(source, ret);
        console.log(ret);
        return ret;
    }

    function main() {
        var textArea = document.getElementById('crux_source');
        var resultDiv = document.getElementById('js_source');
        var errorDiv = document.getElementById('errors');
        var runButton = document.getElementById('run');
        var compileButton = document.getElementById('compile');

        compileButton.addEventListener('click', function () {
            var content = textArea.value;
            var res = compileCrux(content);
            if (res.error) {
                errorDiv.textContent = res.error;
            } else {
                errorDiv.textContent = '';
                resultDiv.textContent = res.result;
            }
        });

        runButton.addEventListener('click', function () {
            var content = textArea.value;
            var res = compileCrux(content);
            if (res.error) {
                errorDiv.textContent = res.error;
            } else {
                errorDiv.textContent = '';
                resultDiv.textContent = res.result;
                eval(res.result);
            }
        });
    }

    main();
  </script>
</html>
